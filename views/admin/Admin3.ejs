<!DOCTYPE html>
<html>

<% include ../admin/headerAd.ejs %>


<body class="bg-warning">
  <div class="">
    <div class="container mx-auto p-0">
      <div class="row">
        <div class="col-md-12 m-3"> </div>
      </div>
    </div>
  </div>
  <div class="py-5">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <div class="card bg-light text-center px-5py p-4">
            <h4 class="py-0 text-warning">
              <%= payload.name %><br>
              <%= payload.nickname %> #<%= payload.year %><br>
              <%= payload.group %>
            </h4>
            <p class="lead text-left mx-auto">
              สิ่งที่แพ้ :<%= payload.allegic%>
              <br>ไซส์เสื้อ :<%= payload.size%>
            </p>
           
            <% if( !(payload.shirt === 'รับเสื้อแล้ว') ){ %>

            <div class="row" id="div-car">
              <div class="col-md-12" style="padding-right: 0px; padding-left: 0px;">
                <h1 class="text-danger" id="car-text" >เลือกคันรถ</h1>
                <a class="btn w-30 m-1 btn-success" id="car1" style="color: white; text-decoration: underline; cursor: pointer;" > </a>
                <a class="btn w-30 m-1 btn-danger" id="car2"  style="color: white; text-decoration: underline; cursor: pointer;" > </a>
              </div>
            </div>

            <div class="row" id= "div-money-shirt">
              <div class="col-md-12" style="padding-right: 0px; padding-left: 0px;">
                <br>                
                <h4 class="text-success" id="paid" >จ่ายเงินเรียบร้อยจ้า</h4>
                <h1 class="text-danger" id= "unpaid" >ยังไม่ได้จ่ายเงิน!!</h1>
                <h4 class="text-success py-0 " id="car-num">รถ: <%= payload.car %></h4>
                <a class="btn w-30 m-1 btn-success" id="money-btn-1" style="color: white; text-decoration: underline; cursor: pointer;" >จ่ายเงินเรียบร้อยจ้า</a>
                <a class="btn w-30 m-1 btn-danger" id="money-btn-2"  style="padding: 9px 40px 9px 40px; color: white; text-decoration: underline; cursor: pointer;" >ค้างชำระ</a>
                <a class="btn w-75 m-3 btn-success" id="get-shirt" style="color: white; text-decoration: underline; cursor: pointer;">รับเสื้อเรียบร้อยเด้อ</a>
              </div>
            </div>

            <% } else { %>

            <div class="row" id= "div-money-car">
              <div class="col-md-12">
            <% if( (payload.pay === 'จ่ายแล้ว') ) {%>
                <h4 class="text-success" id="paid" >จ่ายเงินเรียบร้อยจ้า</h4>
            <%} else {%>
                <h1 class="text-danger" id= "unpaid" >ยังไม่ได้จ่ายเงิน!!</h1>
            <% }%>            
                <h4 class="text-success py-0" id="car-num">รถ: <%= payload.car %></h4>                 
                <h4 class="text-success py-0" id="get-shirt">รับเสื้อแล้ว</h4>                               
              </div>
            </div>

            <% }%>

            <div class="card-body">
              <div class="col-md-12">
                <a class="btn w-50 m-3"  style="color: white; text-decoration: underline; cursor: pointer; background-color: #878787; border-color: #878787; " href="/admin/confirm">Back</a>
              </div>
            </div>
            
          </div>
        </div>
      </div>
    </div>
  </div>
   
  <% include ../admin/scriptAd.ejs %>
</body>
<script>
  $(function () {

      //button show car [บัณฑิต , ปี1 , ปี2 , ปี3 , ปี4 , guest]
      <% if( (payload.year === 'ปี 1' || payload.year === 'ปี 2') && payload.car.includes("ฝ่ายทะเบียน")){ %>
          $('#car-num').hide();
          $('#car1').html("รถคันที่ 1");
          $('#car2').html("รถคันที่ 2");          
      <% } else if( (payload.year === 'ปี 4' ) && payload.car.includes("ฝ่ายทะเบียน")){ %>
          $('#car-num').hide();        
          $('#car1').html("รถคันที่ 3");
          $('#car2').html("รถคันที่ 4");   
      <% } else{ %>
          $('#car-num').show();                
          $('#div-car').hide();      
      <% } %>

      //check button hide/show
      <% if( (payload.pay === 'จ่ายแล้ว')){ %>
        $('#unpaid').hide();
        $('#money-btn-1').hide();
        $('#money-btn-2').hide();
      <% } else{ %>
        $("#get-shirt").hide();
        $('#paid').hide();
      <%  }%>

      //button paid
      function swapButton() {
        $("#money-btn-1").hide();
        $("#money-btn-2").hide();
        $("#get-shirt").show();
        $('#unpaid').hide();
        $('#paid').show();
      }

      //button unpaid
      function swapButtonunpaid() {
        $("#money-btn-1").hide();
        $("#money-btn-2").hide();
        $("#get-shirt").show();
      }

      var index = <%=payload.index%>;

      // button paid 
      $("#money-btn-1").click(function(){
        swapButton();
         $.ajax({
            url: '/admin/update/money',
            type:'POST',
            data: {index : index},
            success: function (success) {
              if(success.success){
                $('#unpaid').hide();
                $('#paid').show();
              }else{
                swal("แย่จัง!!", "ผิดพลาดเรื่อง การเงิน ขอโทษด้วย", "error").then(() => {
                  window.location.reload();              
                });
              }
            }
          });
      });

      // button unpaid 
      $("#money-btn-2").click(function(){
        swapButtonunpaid();
      });

      // button get shirt
      $("#get-shirt").click(function(){

        $.ajax({
          url: '/admin/update/shirt',
          type:'POST',
          data :  {index : index},
          success: function (success) {
            if(success.success){
              swal("เย้!!", "รับเสื้อเรียบร้อยแล้วครับ", "success").then(() => {
                window.location.reload();              
              });
            }else{
              swal("แย่จัง!!", "ผิดพลาดเรื่อง เสื้อ ขอโทษด้วย", "error").then(() => {
                window.location.reload();                            
              });
            }
          },
          error: (err) => {
            console.log(err);
          }
        });
      });

      // button car       
      $("#car1").click(function(){

        var car = $("#car1").text();  

          $.ajax({
          url: '/admin/update/car',
          type:'POST',
          data :  {car : car , index : index},
          success: function (success) {
            if(success.success){
              $('#div-car').hide(); 
              window.location.reload();    // reload for show numbercar (numbercar form sheets)                                                      
            }else{
              swal("แย่จัง!!", "ผิดพลาดเรื่อง รถ ขอโทษด้วย", "error").then(() => {
                window.location.reload();                                                                          
              });
            }
          },
          error: (err) => {
            console.log(err);
          }
        });
      })

      // button car 
       $("#car2").click(function(){

        var car = $("#car2").text();

          $.ajax({
          url: '/admin/update/car',
          type:'POST',
          data :  {car : car , index : index},
          success: function (success) {
            if(success.success){
              $('#div-car').hide();
              window.location.reload();                      
            }else{
              swal("แย่จัง!!", "ผิดพลาดเรื่อง รถ ขอโทษด้วย", "error").then(() => {
                window.location.reload();                                                          
              });
            }
          },
          error: (err) => {
            console.log(err);
          }
        });
      })
  });
</script>


</html>
